results <- map(years_geoid_df, maxNDVI)
results <- bind_rows(results)
selected_counties <- results %>%
group_by(GEOID) %>%
summarise(n=n()) %>% filter(n==13)
results_full_history <- results %>%
filter(GEOID %in% selected_counties$GEOID)
mod <- lm(yield ~ NDVI + I(NDVI^2) + GEOID,data=results_full_history)
summary(mod)
plot(mod$residuals)
hist(mod$residuals)
library(tidyverse)
## Insert your file path to the data from your local computer
## Set wd using setwd('path) /Users/uofm_research/Rprojects/integrationNDVI/
filePath = './df250mSoy.csv'
df <- read_csv(filePath)
df$date <- as.Date(with(df, paste(Year, Month, Day,sep="-")), "%Y-%m-%d")
df <- df %>% filter(Year > 2005)
years_geoid_df <- group_split(df, Year, GEOID)
maxNDVI = function(county_year) {
max_ndvi <- county_year[which.max(county_year$NDVI), ]
max_ndvi$NDVI <- max_ndvi$NDVI / 10000
return(max_ndvi)
}
results <- map(years_geoid_df, maxNDVI)
results <- bind_rows(results)
selected_counties <- results %>%
group_by(GEOID) %>%
summarise(n=n()) %>% filter(n==13)
results_full_history <- results %>%
filter(GEOID %in% selected_counties$GEOID)
mod <- lm(yield ~ NDVI + I(NDVI^2) + GEOID,data=results_full_history)
summary(mod)
library(tidyverse)
## Insert your file path to the data from your local computer
## Set wd using setwd('path) /Users/uofm_research/Rprojects/integrationNDVI/
filePath = './df500mSoy.csv'
df <- read_csv(filePath)
df$date <- as.Date(with(df, paste(Year, Month, Day,sep="-")), "%Y-%m-%d")
df <- df %>% filter(Year > 2005)
years_geoid_df <- group_split(df, Year, GEOID)
maxNDVI = function(county_year) {
max_ndvi <- county_year[which.max(county_year$NDVI), ]
max_ndvi$NDVI <- max_ndvi$NDVI / 10000
return(max_ndvi)
}
results <- map(years_geoid_df, maxNDVI)
results <- bind_rows(results)
selected_counties <- results %>%
group_by(GEOID) %>%
summarise(n=n()) %>% filter(n==13)
results_full_history <- results %>%
filter(GEOID %in% selected_counties$GEOID)
mod <- lm(yield ~ NDVI + I(NDVI^2) + GEOID,data=results_full_history)
summary(mod)
## Insert your file path to the data from your local computer
## Set wd using setwd('path) /Users/uofm_research/Rprojects/integrationNDVI/
filePath = './df500mSoy.csv'
df <- read_csv(filePath)
df <- read_csv(filePath)
df$date <- as.Date(with(df, paste(Year, Month, Day,sep="-")), "%Y-%m-%d")
df <- df %>% filter(Year > 2005)
years_geoid_df <- group_split(df, Year, GEOID)
maxNDVI = function(county_year) {
max_ndvi <- county_year[which.max(county_year$NDVI), ]
max_ndvi$NDVI <- max_ndvi$NDVI / 10000
return(max_ndvi)
}
results <- map(years_geoid_df, maxNDVI)
results <- bind_rows(results)
selected_counties <- results %>%
group_by(GEOID) %>%
summarise(n=n()) %>% filter(n==13)
results_full_history <- results %>%
filter(GEOID %in% selected_counties$GEOID)
mod <- lm(yield ~ NDVI + I(NDVI^2) + GEOID,data=results_full_history)
summary(mod)
library(tidyverse)
## Insert your file path to the data from your local computer
## Set wd using setwd('path) /Users/uofm_research/Rprojects/integrationNDVI/
filePath = './df1kmSoy.csv'
df <- read_csv(filePath)
df$date <- as.Date(with(df, paste(Year, Month, Day,sep="-")), "%Y-%m-%d")
df <- df %>% filter(Year > 2005)
years_geoid_df <- group_split(df, Year, GEOID)
maxNDVI = function(county_year) {
max_ndvi <- county_year[which.max(county_year$NDVI), ]
max_ndvi$NDVI <- max_ndvi$NDVI / 10000
return(max_ndvi)
}
results <- map(years_geoid_df, maxNDVI)
results <- bind_rows(results)
selected_counties <- results %>%
group_by(GEOID) %>%
summarise(n=n()) %>% filter(n==13)
results_full_history <- results %>%
filter(GEOID %in% selected_counties$GEOID)
mod <- lm(yield ~ NDVI + I(NDVI^2) + GEOID,data=results_full_history)
summary(mod)
library(tidyverse)
## Insert your file path to the data from your local computer
## Set wd using setwd('path) /Users/uofm_research/Rprojects/integrationNDVI/
filePath = './df250mCorn.csv'
df <- read_csv(filePath)
df$date <- as.Date(with(df, paste(Year, Month, Day,sep="-")), "%Y-%m-%d")
df <- df %>% filter(Year > 2005)
years_geoid_df <- group_split(df, Year, GEOID)
maxNDVI = function(county_year) {
max_ndvi <- county_year[which.max(county_year$NDVI), ]
max_ndvi$NDVI <- max_ndvi$NDVI / 10000
return(max_ndvi)
}
results <- map(years_geoid_df, maxNDVI)
results <- bind_rows(results)
selected_counties <- results %>%
group_by(GEOID) %>%
summarise(n=n()) %>% filter(n==13)
results_full_history <- results %>%
filter(GEOID %in% selected_counties$GEOID)
mod <- lm(yield ~ NDVI + I(NDVI^2) + GEOID,data=results_full_history)
summary(mod)
library(tidyverse)
## Insert your file path to the data from your local computer
## Set wd using setwd('path) /Users/uofm_research/Rprojects/integrationNDVI/
filePath = './df500mCorn.csv'
df <- read_csv(filePath)
df$date <- as.Date(with(df, paste(Year, Month, Day,sep="-")), "%Y-%m-%d")
df <- df %>% filter(Year > 2005)
years_geoid_df <- group_split(df, Year, GEOID)
maxNDVI = function(county_year) {
max_ndvi <- county_year[which.max(county_year$NDVI), ]
max_ndvi$NDVI <- max_ndvi$NDVI / 10000
return(max_ndvi)
}
results <- map(years_geoid_df, maxNDVI)
results <- bind_rows(results)
selected_counties <- results %>%
group_by(GEOID) %>%
summarise(n=n()) %>% filter(n==13)
results_full_history <- results %>%
filter(GEOID %in% selected_counties$GEOID)
mod <- lm(yield ~ NDVI + I(NDVI^2) + GEOID,data=results_full_history)
summary(mod)
library(tidyverse)
## Insert your file path to the data from your local computer
## Set wd using setwd('path) /Users/uofm_research/Rprojects/integrationNDVI/
filePath = './df1kmCorn.csv'
df <- read_csv(filePath)
df$date <- as.Date(with(df, paste(Year, Month, Day,sep="-")), "%Y-%m-%d")
df <- df %>% filter(Year > 2005)
years_geoid_df <- group_split(df, Year, GEOID)
maxNDVI = function(county_year) {
max_ndvi <- county_year[which.max(county_year$NDVI), ]
max_ndvi$NDVI <- max_ndvi$NDVI / 10000
return(max_ndvi)
}
results <- map(years_geoid_df, maxNDVI)
results <- bind_rows(results)
selected_counties <- results %>%
group_by(GEOID) %>%
summarise(n=n()) %>% filter(n==13)
results_full_history <- results %>%
filter(GEOID %in% selected_counties$GEOID)
mod <- lm(yield ~ NDVI + I(NDVI^2) + GEOID,data=results_full_history)
summary(mod)
library(tidyverse)
## Insert your file path to the data from your local computer
## Set wd using setwd('path) /Users/uofm_research/Rprojects/integrationNDVI/
filePath = './df250mWinterWheat.csv'
df <- read_csv(filePath)
df$date <- as.Date(with(df, paste(Year, Month, Day,sep="-")), "%Y-%m-%d")
df <- df %>% filter(Year > 2005)
years_geoid_df <- group_split(df, Year, GEOID)
maxNDVI = function(county_year) {
max_ndvi <- county_year[which.max(county_year$NDVI), ]
max_ndvi$NDVI <- max_ndvi$NDVI / 10000
return(max_ndvi)
}
results <- map(years_geoid_df, maxNDVI)
results <- bind_rows(results)
selected_counties <- results %>%
group_by(GEOID) %>%
summarise(n=n()) %>% filter(n==13)
results_full_history <- results %>%
filter(GEOID %in% selected_counties$GEOID)
mod <- lm(yield ~ NDVI + I(NDVI^2) + GEOID,data=results_full_history)
summary(mod)
library(tidyverse)
## Insert your file path to the data from your local computer
## Set wd using setwd('path) /Users/uofm_research/Rprojects/integrationNDVI/
filePath = './df500mWinterWheat.csv'
df <- read_csv(filePath)
df$date <- as.Date(with(df, paste(Year, Month, Day,sep="-")), "%Y-%m-%d")
df <- df %>% filter(Year > 2005)
years_geoid_df <- group_split(df, Year, GEOID)
maxNDVI = function(county_year) {
max_ndvi <- county_year[which.max(county_year$NDVI), ]
max_ndvi$NDVI <- max_ndvi$NDVI / 10000
return(max_ndvi)
}
results <- map(years_geoid_df, maxNDVI)
results <- bind_rows(results)
selected_counties <- results %>%
group_by(GEOID) %>%
summarise(n=n()) %>% filter(n==13)
results_full_history <- results %>%
filter(GEOID %in% selected_counties$GEOID)
mod <- lm(yield ~ NDVI + I(NDVI^2) + GEOID,data=results_full_history)
summary(mod)
library(tidyverse)
## Insert your file path to the data from your local computer
## Set wd using setwd('path) /Users/uofm_research/Rprojects/integrationNDVI/
filePath = './df500mWinterWheat.csv'
df <- read_csv(filePath)
df$date <- as.Date(with(df, paste(Year, Month, Day,sep="-")), "%Y-%m-%d")
df <- df %>% filter(Year > 2005)
df
years_geoid_df <- group_split(df, Year, GEOID)
maxNDVI = function(county_year) {
max_ndvi <- county_year[which.max(county_year$NDVI), ]
max_ndvi$NDVI <- max_ndvi$NDVI / 10000
return(max_ndvi)
}
results <- map(years_geoid_df, maxNDVI)
results <- bind_rows(results)
selected_counties <- results %>%
group_by(GEOID) %>%
summarise(n=n()) %>% filter(n==13)
results_full_history <- results %>%
filter(GEOID %in% selected_counties$GEOID)
mod <- lm(yield ~ NDVI + I(NDVI^2) + GEOID,data=results_full_history)
summary(mod)
library(tidyverse)
## Insert your file path to the data from your local computer
## Set wd using setwd('path) /Users/uofm_research/Rprojects/integrationNDVI/
filePath = './df1kmWinterWheat.csv'
df <- read_csv(filePath)
df$date <- as.Date(with(df, paste(Year, Month, Day,sep="-")), "%Y-%m-%d")
df <- df %>% filter(Year > 2005)
years_geoid_df <- group_split(df, Year, GEOID)
maxNDVI = function(county_year) {
max_ndvi <- county_year[which.max(county_year$NDVI), ]
max_ndvi$NDVI <- max_ndvi$NDVI / 10000
return(max_ndvi)
}
results <- map(years_geoid_df, maxNDVI)
results <- bind_rows(results)
selected_counties <- results %>%
group_by(GEOID) %>%
summarise(n=n()) %>% filter(n==13)
results_full_history <- results %>%
filter(GEOID %in% selected_counties$GEOID)
mod <- lm(yield ~ NDVI + I(NDVI^2) + GEOID,data=results_full_history)
summary(mod)
library(tidyverse)
## Insert your file path to the data from your local computer
## Set wd using setwd('path) /Users/uofm_research/Rprojects/integrationNDVI/
filePath = './df1kmSpringWheat.csv'
df <- read_csv(filePath)
df$date <- as.Date(with(df, paste(Year, Month, Day,sep="-")), "%Y-%m-%d")
df <- df %>% filter(Year > 2005)
years_geoid_df <- group_split(df, Year, GEOID)
maxNDVI = function(county_year) {
max_ndvi <- county_year[which.max(county_year$NDVI), ]
max_ndvi$NDVI <- max_ndvi$NDVI / 10000
return(max_ndvi)
}
results <- map(years_geoid_df, maxNDVI)
results <- bind_rows(results)
selected_counties <- results %>%
group_by(GEOID) %>%
summarise(n=n()) %>% filter(n==13)
results_full_history <- results %>%
filter(GEOID %in% selected_counties$GEOID)
mod <- lm(yield ~ NDVI + I(NDVI^2) + GEOID,data=results_full_history)
summary(mod)
library(tidyverse)
## Insert your file path to the data from your local computer
## Set wd using setwd('path) /Users/uofm_research/Rprojects/integrationNDVI/
filePath = './df500mSpringWheat.csv'
df <- read_csv(filePath)
df$date <- as.Date(with(df, paste(Year, Month, Day,sep="-")), "%Y-%m-%d")
df <- df %>% filter(Year > 2005)
years_geoid_df <- group_split(df, Year, GEOID)
maxNDVI = function(county_year) {
max_ndvi <- county_year[which.max(county_year$NDVI), ]
max_ndvi$NDVI <- max_ndvi$NDVI / 10000
return(max_ndvi)
}
results <- map(years_geoid_df, maxNDVI)
results <- bind_rows(results)
selected_counties <- results %>%
group_by(GEOID) %>%
summarise(n=n()) %>% filter(n==13)
results_full_history <- results %>%
filter(GEOID %in% selected_counties$GEOID)
mod <- lm(yield ~ NDVI + I(NDVI^2) + GEOID,data=results_full_history)
summary(mod)
library(tidyverse)
## Insert your file path to the data from your local computer
## Set wd using setwd('path) /Users/uofm_research/Rprojects/integrationNDVI/
filePath = './df250mSpringWheat.csv'
df <- read_csv(filePath)
df$date <- as.Date(with(df, paste(Year, Month, Day,sep="-")), "%Y-%m-%d")
df <- df %>% filter(Year > 2005)
years_geoid_df <- group_split(df, Year, GEOID)
maxNDVI = function(county_year) {
max_ndvi <- county_year[which.max(county_year$NDVI), ]
max_ndvi$NDVI <- max_ndvi$NDVI / 10000
return(max_ndvi)
}
results <- map(years_geoid_df, maxNDVI)
results <- bind_rows(results)
selected_counties <- results %>%
group_by(GEOID) %>%
summarise(n=n()) %>% filter(n==13)
results_full_history <- results %>%
filter(GEOID %in% selected_counties$GEOID)
mod <- lm(yield ~ NDVI + I(NDVI^2) + GEOID,data=results_full_history)
summary(mod)
library(tidyverse)
## Insert your file path to the data from your local computer
## Set wd using setwd('path) /Users/uofm_research/Rprojects/integrationNDVI/
filePath = './df250mWinterWheat.csv'
df <- read_csv(filePath)
df$date <- as.Date(with(df, paste(Year, Month, Day,sep="-")), "%Y-%m-%d")
df <- df %>% filter(Year > 2005)
years_geoid_df <- group_split(df, Year, GEOID)
maxNDVI = function(county_year) {
max_ndvi <- county_year[which.max(county_year$NDVI), ]
max_ndvi$NDVI <- max_ndvi$NDVI / 10000
return(max_ndvi)
}
results <- map(years_geoid_df, maxNDVI)
results <- bind_rows(results)
selected_counties <- results %>%
group_by(GEOID) %>%
summarise(n=n()) %>% filter(n==13)
results_full_history <- results %>%
filter(GEOID %in% selected_counties$GEOID)
mod <- lm(yield ~ NDVI + I(NDVI^2) + GEOID,data=results_full_history)
summary(mod)
library(tidyverse)
## Insert your file path to the data from your local computer
## Set wd using setwd('path) /Users/uofm_research/Rprojects/integrationNDVI/
filePath = './df1kmWinterWheat.csv'
df <- read_csv(filePath)
df$date <- as.Date(with(df, paste(Year, Month, Day,sep="-")), "%Y-%m-%d")
df <- df %>% filter(Year > 2005)
years_geoid_df <- group_split(df, Year, GEOID)
maxNDVI = function(county_year) {
max_ndvi <- county_year[which.max(county_year$NDVI), ]
max_ndvi$NDVI <- max_ndvi$NDVI / 10000
return(max_ndvi)
}
results <- map(years_geoid_df, maxNDVI)
results <- bind_rows(results)
selected_counties <- results %>%
group_by(GEOID) %>%
summarise(n=n()) %>% filter(n==13)
results_full_history <- results %>%
filter(GEOID %in% selected_counties$GEOID)
mod <- lm(yield ~ NDVI + I(NDVI^2) + GEOID,data=results_full_history)
summary(mod)
library(tidyverse)
## Insert your file path to the data from your local computer
## Set wd using setwd('path) /Users/uofm_research/Rprojects/integrationNDVI/
file_path_read = './df250mCorn.csv'
file_path_write = './CornMaxNDVI.csv'
df <- read_csv(file_path_read)
df$date <- as.Date(with(df, paste(Year, Month, Day,sep="-")), "%Y-%m-%d")
df <- df %>% filter(Year > 2005)
years_geoid_df <- group_split(df, Year, GEOID)
calulate_max_ndvi = function(county_year) {
max_ndvi <- county_year[which.max(county_year$NDVI), ]
max_ndvi$NDVI <- max_ndvi$NDVI / 10000
return(max_ndvi)
}
results <- map(years_geoid_df, calculate_max_ndvi)
results <- bind_rows(results)
selected_counties <- results %>%
group_by(GEOID) %>%
summarise(n=n()) %>% filter(n==13)
results_full_history <- results %>%
filter(GEOID %in% selected_counties$GEOID)
write_csv(results_full_history, file_path_write)
## Test max NDVI
mod <- lm(yield ~ NDVI + I(NDVI^2) + GEOID,data=results_full_history)
summary(mod)
library(tidyverse)
## Insert your file path to the data from your local computer
## Set wd using setwd('path) /Users/uofm_research/Rprojects/integrationNDVI/
file_path_read = './df250mCorn.csv'
file_path_write = './CornMaxNDVI.csv'
df <- read_csv(file_path_read)
df$date <- as.Date(with(df, paste(Year, Month, Day,sep="-")), "%Y-%m-%d")
df <- df %>% filter(Year > 2005)
years_geoid_df <- group_split(df, Year, GEOID)
calculate_max_ndvi = function(county_year) {
max_ndvi <- county_year[which.max(county_year$NDVI), ]
max_ndvi$NDVI <- max_ndvi$NDVI / 10000
return(max_ndvi)
}
results <- map(years_geoid_df, calculate_max_ndvi)
results <- bind_rows(results)
selected_counties <- results %>%
group_by(GEOID) %>%
summarise(n=n()) %>% filter(n==13)
results_full_history <- results %>%
filter(GEOID %in% selected_counties$GEOID)
write_csv(results_full_history, file_path_write)
## Test max NDVI
mod <- lm(yield ~ NDVI + I(NDVI^2) + GEOID,data=results_full_history)
summary(mod)
## Soy 250-0.7713, 500-0.7654, 1km-0.7556
## Corn 250-0.7854, 500-0.7815, 1km- 0.7629
## Winter Wheat 250- 0.7908, 500-0.7927, 1km-0.8142
## Spring Wheat 250-0.4223, 500-0.3721, 1km-0.3202
library(tidyverse)
## Insert your file path to the data from your local computer
## Set wd using setwd('path) /Users/uofm_research/Rprojects/integrationNDVI/
file_path_read = './df250mCorn.csv'
file_path_write = './CornMaxNDVI.csv'
df <- read_csv(file_path_read)
df$date <- as.Date(with(df, paste(Year, Month, Day,sep="-")), "%Y-%m-%d")
df <- df %>% filter(Year > 2005)
years_geoid_df <- group_split(df, Year, GEOID)
years_geoid_df
library(tidyverse)
## Insert your file path to the data from your local computer
## Set wd using setwd('path) /Users/uofm_research/Rprojects/integrationNDVI/
file_path_read = './df250mCorn.csv'
file_path_write = './CornMaxNDVI.csv'
file_path_write = './CornIntNDVI.csv'
df <- read_csv(file_path_read)
df$date <- as.Date(with(df, paste(Year, Month, Day,sep="-")), "%Y-%m-%d")
df <- df %>% filter(Year > 2005)
years_geoid_df <- group_split(df, Year, GEOID)
years_geoid_df
years_geoid_df[[1]]
years_geoid_df[[1]]$NDVI
ndvi_func <- splinefun(1:nrow(county_year[[1]]), y = county_year[[1]]$NDVI, method = "fmm", ties = mean)
years_geoid_df[[1000]]
years_geoid_df[[1000]]$NDVI
years_geoid_df[[2000]]$NDVI
years_geoid_df[[5000]]$NDVI
sing <- years_geoid_df[[5000]]
ndvi_func <- splinefun(1:nrow(sing), y = sing$NDVI, method = "fmm", ties = mean)
ndvi_func()
ndvi_func
plot(ndvi_func())
integrate(fnToint)
fnToint <- splinefun(ind$index, y = ind$NDVI, method = "fmm", ties = mean)
ndvi_func <- splinefun(1:nrow(sing), y = sing$NDVI, method = "fmm", ties = mean)
integrate(fnToint,7,18)
integrate(ndvi_func,7,18)
integrate(ndvi_func,7,18)[1]
integrate(ndvi_func,7,18)$value
library(tidyverse)
## Insert your file path to the data from your local computer
## Set wd using setwd('path) /Users/uofm_research/Rprojects/integrationNDVI/
file_path_read = './df250mCorn.csv'
file_path_write = './CornIntNDVI.csv'
df <- read_csv(file_path_read)
df$date <- as.Date(with(df, paste(Year, Month, Day,sep="-")), "%Y-%m-%d")
df <- df %>% filter(Year > 2005)
years_geoid_df <- group_split(df, Year, GEOID)
calculate_int_ndvi = function(county_year, start, end) {
county_year$NDVI <- county_year$NDVI /10000
ndvi_func <- splinefun(1:nrow(county_year), y = county_year$NDVI, method = "fmm", ties = mean)
county_year_output <- county_year[1,]
county_year_output$NDVI <- integrate(ndvi_func,start,end)$value
return(max_ndvi)
}
results <- map(years_geoid_df, calculate_int_ndvi)
library(tidyverse)
## Insert your file path to the data from your local computer
## Set wd using setwd('path) /Users/uofm_research/Rprojects/integrationNDVI/
file_path_read = './df250mCorn.csv'
file_path_write = './CornIntNDVI.csv'
df <- read_csv(file_path_read)
df$date <- as.Date(with(df, paste(Year, Month, Day,sep="-")), "%Y-%m-%d")
df <- df %>% filter(Year > 2005)
years_geoid_df <- group_split(df, Year, GEOID)
calculate_int_ndvi = function(county_year, start, end) {
if(is.na(county_year$NDVI)) {
county_year_output <- county_year[1,]
return(county_year_output)
}
county_year$NDVI <- county_year$NDVI /10000
ndvi_func <- splinefun(1:nrow(county_year), y = county_year$NDVI, method = "fmm", ties = mean)
county_year_output <- county_year[1,]
county_year_output$NDVI <- integrate(ndvi_func,start,end)$value
return(county_year_output)
}
results <- map(years_geoid_df, calculate_int_ndvi)
results <- map(years_geoid_df, calculate_int_ndvi, start=5, end = 10)
warnings()
is.na(county_year$NDVI)
results[[1]]
results[[1]][10:15]
results <- bind_rows(results)
results
results <- drop_na(results)
selected_counties <- results %>%
group_by(GEOID) %>%
summarise(n=n()) %>% filter(n==13)
results_full_history <- results %>%
filter(GEOID %in% selected_counties$GEOID)
## Test max NDVI
mod <- lm(yield ~ NDVI + I(NDVI^2) + GEOID,data=results_full_history)
summary(mod)
